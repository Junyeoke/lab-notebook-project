/* 1. 글로벌 및 루트 설정 */
:root {
  /* (컬러 팔레트는 동일) */
  --color-primary: #005a9c;
  --color-primary-dark: #003e6b;
  --color-secondary: #e6f7ff;
  --color-text-dark: #222;
  --color-text-light: #555;
  --color-text-on-primary: #ffffff;
  --color-border: #e0e0e0;
  --color-bg-light: #f9f9f9;
  --color-bg-white: #ffffff;
  --color-danger: #d93025;
  --color-danger-hover: #b0261d;
  --color-warning: #ffc107;
  --color-warning-hover: #e0a800;

  --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.05);
  --shadow-medium: 0 4px 10px rgba(0, 0, 0, 0.08);
  --shadow-hover: 0 6px 12px rgba(0, 0, 0, 0.1); /* [애니메이션 추가] 호버용 그림자 */
  --border-radius: 8px;

  /* [애니메이션 추가] 전환 속도 */
  --transition-fast: 0.2s ease-in-out;
  --transition-medium: 0.3s ease-in-out;
}

/* [애니메이션 추가] 뷰 전환 및 로드 시 사용할 키프레임 */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px); /* 살짝 아래에서 위로 */
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInFromLeft {
  from {
    opacity: 0;
    transform: translateX(-50px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}


/* 2. 기본 HTML 태그 리셋 (동일) */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
  Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background-color: var(--color-bg-light);
  color: var(--color-text-dark);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
* {
  box-sizing: border-box;
}

/* 3. 앱 헤더 (동일) */
.app-header {
  background-color: var(--color-primary);
  color: var(--color-text-on-primary);
  padding: 15px 30px;
  box-shadow: var(--shadow-medium);
  border-bottom: 2px solid var(--color-primary-dark);
  display: flex;
  align-items: center;
  gap: 10px;
}
.app-header h1 {
  margin: 0;
  font-size: 1.5rem;
}

/* 4. 메인 2단 레이아웃 (동일) */
.app-body {
  display: flex;
  height: calc(100vh - 74px);
}

/* 5. 왼쪽: 사이드바 (너비 고정) */
.sidebar {
  width: 350px;
  min-width: 350px;
  background-color: var(--color-bg-white);
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0; /* 너비 고정 */

  /* [애니메이션 추가] 페이지 로드 시 왼쪽에서 슬라이드 인 */
  animation: slideInFromLeft 0.5s var(--transition-medium);
}

/* 5-1. 사이드바 헤더 (동일) */
.sidebar-header {
  padding: 15px;
  border-bottom: 1px solid var(--color-border);
}

.create-note-btn {
  /* (기존 스타일 동일) */
  background-color: var(--color-primary);
  color: var(--color-text-on-primary);
  border: none;
  border-radius: var(--border-radius);
  padding: 12px 15px;
  font-size: 1rem;
  font-weight: 600;
  width: 100%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;

  /* [애니메이션 수정] 부드러운 전환 효과 추가 */
  transition: background-color var(--transition-fast),
  transform var(--transition-fast),
  box-shadow var(--transition-fast);
}
.create-note-btn:hover {
  background-color: var(--color-primary-dark);
  /* [애니메이션 추가] 마우스 올리면 살짝 커지는 효과 */
  transform: scale(1.02);
  box-shadow: var(--shadow-hover);
}

/* 5-2. 노트 목록 스크롤 영역 (동일) */
.note-list {
  flex-grow: 1;
  overflow-y: auto;
  padding: 10px;
}

/* 5-3. 개별 노트 카드 (요약) */
.note-card {
  padding: 15px;
  border-bottom: 1px solid var(--color-border);
  cursor: pointer;
  border-radius: var(--border-radius);
  margin-bottom: 5px;
  border-right: 4px solid transparent; /* 선택 효과를 위한 투명 테두리 */

  /* [애니메이션 수정] 모든 속성(배경색, 그림자, 위치)을 부드럽게 전환 */
  transition: background-color var(--transition-fast),
  transform var(--transition-fast),
  box-shadow var(--transition-fast),
  border-color var(--transition-fast);
}
.note-card:hover {
  background-color: #f0f0f0;
  /* [애니메이션 추가] 마우스 올리면 살짝 떠오르는 효과 */
  transform: translateY(-2px);
  box-shadow: var(--shadow-light);
}
.note-card.selected {
  background-color: var(--color-secondary);
  border-right-color: var(--color-primary); /* 오른쪽 테두리 색상으로 선택 표시 */
  transform: translateY(0); /* 선택 시에는 떠오르지 않음 */
}

/* (노트 카드 내부 h3, p, small 스타일은 동일) */
.note-card h3 {
  margin: 0 0 5px 0;
  font-size: 1.1rem;
  color: var(--color-text-dark);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.note-card p {
  margin: 0 0 8px 0;
  font-size: 0.9rem;
  color: var(--color-text-light);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: 2.7em;
}
.note-card small {
  font-size: 0.8rem;
  color: var(--color-text-light);
  opacity: 0.8;
}

/* 6. 오른쪽: 메인 콘텐츠 (동일) */
.main-content {
  flex-grow: 1;
  background-color: var(--color-bg-light);
  overflow-y: auto;
  padding: 30px;
}

/* 6-1. 환영 메시지 (기본 뷰) */
.welcome-view {
  text-align: center;
  padding-top: 100px;
  color: var(--color-text-light);

  /* [애니메이션 추가] 뷰가 나타날 때 페이드 인 */
  animation: fadeIn 0.5s var(--transition-medium);
}
.welcome-view svg {
  font-size: 4rem;
  margin-bottom: 20px;
  color: var(--color-primary);
  opacity: 0.7;
}

/* 6-2. 상세 보기 뷰 (읽기) */
.detail-view {
  background-color: var(--color-bg-white);
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-light);

  /* [애니메이션 추가] 뷰가 나타날 때 페이드 인 */
  animation: fadeIn 0.5s var(--transition-medium);
}

.detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--color-border);
  padding-bottom: 15px;
  margin-bottom: 20px;
}
.detail-header h2 {
  margin: 0;
  font-size: 1.8rem;
  color: var(--color-text-dark);
  word-break: break-all;
}
.detail-buttons {
  display: flex;
  gap: 10px;
  flex-shrink: 0;
}

/* 공통 아이콘 버튼 */
.icon-button {
  background: none;
  border: none;
  padding: 8px;
  cursor: pointer;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;

  /* [애니메이션 수정] 배경색, 색상, 크기 전환 */
  transition: background-color var(--transition-fast),
  color var(--transition-fast),
  transform var(--transition-fast);
}
.icon-button:hover {
  /* [애니메이션 추가] 마우스 올리면 살짝 커지는 효과 */
  transform: scale(1.1);
}

/* 수정 버튼 */
.edit-button {
  color: var(--color-primary);
}
.edit-button:hover {
  background-color: var(--color-secondary);
}
/* 삭제 버튼 */
.delete-button {
  color: var(--color-danger);
}
.delete-button:hover {
  background-color: #fbebee;
}

/* (상세보기 메타, 콘텐츠, 첨부파일 스타일 동일) */
.detail-meta {
  font-size: 0.9rem;
  color: var(--color-text-light);
  margin-bottom: 25px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.detail-content {
  margin-bottom: 30px;
}
.detail-content p {
  white-space: pre-wrap;
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--color-text-dark);
}
.detail-attachment {
  border-top: 1px solid var(--color-border);
  padding-top: 20px;
}
.detail-attachment h4 {
  margin: 0 0 15px 0;
  font-size: 1.2rem;
  color: var(--color-text-dark);
}
.attached-image {
  max-width: 100%;
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
}
.attached-document a {
  text-decoration: none;
  color: var(--color-primary);
  font-weight: 600;
  padding: 10px 15px;
  background-color: #f4f8ff;
  border-radius: var(--border-radius);
  display: inline-flex;
  align-items: center;
  gap: 8px;
  /* [애니메이션 추가] 문서 링크 호버 효과 */
  transition: background-color var(--transition-fast);
}
.attached-document a:hover {
  background-color: var(--color-secondary);
}


/* 6-3. 폼 뷰 (작성/수정) */
.form-view {
  background-color: var(--color-bg-white);
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow-light);

  /* [애니메이션 추가] 뷰가 나타날 때 페이드 인 */
  animation: fadeIn 0.5s var(--transition-medium);
}
.form-view h2 {
  margin: 0 0 25px 0;
  font-size: 1.8rem;
  color: var(--color-text-dark);
}
.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--color-text-light);
}

/* (폼 입력 요소 공통 스타일 - 기존 transition 유지) */
.form-input,
.form-textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 1rem;
  font-family: inherit;
  /* (이미 부드러운 전환 효과가 있음) */
  transition: border-color var(--transition-fast),
  box-shadow var(--transition-fast);
}
.form-input:focus,
.form-textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-secondary);
}
.form-textarea {
  min-height: 200px;
  resize: vertical;
}
.form-file-input {
  font-size: 0.9rem;
}
.form-file-input small {
  display: block;
  margin-top: 8px;
  color: var(--color-text-light);
}

/* 폼 버튼 그룹 */
.form-buttons {
  display: flex;
  gap: 10px;
  margin-top: 25px;
}

.form-submit-btn,
.form-cancel-btn {
  border: none;
  border-radius: var(--border-radius);
  padding: 12px 20px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;

  /* [애니메이션 수정] 폼 버튼 전환 효과 */
  transition: background-color var(--transition-fast),
  color var(--transition-fast),
  transform var(--transition-fast),
  box-shadow var(--transition-fast);
}

/* 저장/수정 완료 버튼 */
.form-submit-btn {
  background-color: var(--color-primary);
  color: var(--color-text-on-primary);
}
.form-submit-btn:hover {
  background-color: var(--color-primary-dark);
  /* [애니메이션 추가] 호버 시 효과 */
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}
/* 취소 버튼 */
.form-cancel-btn {
  background-color: #f0f0f0;
  color: var(--color-text-light);
}
.form-cancel-btn:hover {
  background-color: #e0e0e0;
  transform: translateY(-2px);
  box-shadow: var(--shadow-light);
}

/* 7. [수정] 프로젝트 목록 (사이드바) */
.project-list-section {
  padding: 10px 10px 15px 10px;
  /* border-bottom은 .note-list의 border-top으로 대체합니다 */
  flex-shrink: 0; /* 높이가 줄어들지 않도록 고정 */

  /* [핵심 수정]
     최대 높이를 뷰포트(화면) 높이의 40%로 제한합니다. (이 값은 조절 가능) */
  max-height: 40vh;

  /* [핵심 수정]
     프로젝트가 max-height를 넘어가면 이 안에서만 스크롤됩니다. */
  overflow-y: auto;
}
.project-list-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-light);
  padding: 5px;
  margin-bottom: 5px;
}
.project-list-header h4 {
  margin: 0;
}

/* 개별 프로젝트 아이템 */
.project-item {
  display: flex;
  align-items: center;
  padding: 10px 12px;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 500;
  color: var(--color-text-dark);

  transition: background-color var(--transition-fast),
  color var(--transition-fast),
  transform var(--transition-fast);
}
.project-item svg { /* 아이콘 */
  margin-right: 10px;
  font-size: 1.1rem;
  color: var(--color-text-light);
  transition: color var(--transition-fast);
}
.project-item span { /* 프로젝트 이름 */
  flex-grow: 1; /* 이름이 공간 다 차지 */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.project-item:hover {
  background-color: #f0f0f0;
  transform: translateX(2px);
}
.project-item.active { /* 선택된 프로젝트 */
  background-color: var(--color-secondary);
  color: var(--color-primary-dark);
  font-weight: 700;
}
.project-item.active svg {
  color: var(--color-primary-dark);
}

/* 프로젝트 삭제 버튼 (휴지통) */
.project-delete-btn {
  background: none;
  border: none;
  color: var(--color-text-light);
  cursor: pointer;
  padding: 2px;
  border-radius: 50%;
  display: none; /* 평소엔 숨김 */
  transition: color var(--transition-fast), background-color var(--transition-fast);
  font-size: 0.9rem;
}
.project-item:hover .project-delete-btn {
  display: block; /* 프로젝트 아이템에 호버 시 보임 */
}
.project-delete-btn:hover {
  color: var(--color-danger);
  background-color: #fbebee;
}

/* 새 프로젝트 추가 폼 */
.add-project-form {
  display: flex;
  margin-top: 10px;
}
.add-project-form input {
  flex-grow: 1;
  border: 1px solid var(--color-border);
  border-right: none;
  padding: 8px 10px;
  font-size: 0.9rem;
  border-radius: var(--border-radius) 0 0 var(--border-radius);
}
.add-project-form input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-secondary);
}
.add-project-form button {
  background-color: var(--color-primary-dark);
  color: white;
  border: none;
  padding: 0 12px;
  font-size: 1.2rem;
  cursor: pointer;
  border-radius: 0 var(--border-radius) var(--border-radius) 0;
  transition: background-color var(--transition-fast);
}
.add-project-form button:hover {
  background-color: var(--color-primary);
}

/* 노트 목록 상단 여백 (프로젝트 리스트와 분리) */
.note-list {
  /* [핵심 수정]
     flex-grow: 1 -> 부모(.sidebar)의 남은 공간을 모두 차지합니다. */
  flex-grow: 1;

  /* [핵심 수정]
     노트가 많아지면 이 안에서만 스크롤됩니다. */
  overflow-y: auto;

  padding: 10px; /* 상하좌우 패딩 통일 */
  border-top: 1px solid var(--color-border); /* 상단 구분선 */
}

/* 노트 목록 비었을 때 메시지 */
.note-list-empty {
  text-align: center;
  color: #777;
  padding: 20px;
  font-size: 0.9rem;
}

/* 8. [추가] 상세 보기(Read View)의 프로젝트 태그 */
.detail-project-tag {
  display: flex;
  align-items: center;
  gap: 6px;
  background-color: #f4f8ff;
  color: var(--color-primary);
  padding: 6px 12px;
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  font-weight: 600;
  margin-right: 10px;
}
.detail-project-tag.uncategorized {
  background-color: #f8f9fa;
  color: var(--color-text-light);
}

/* 9. [수정] 폼의 <select> 태그 스타일 */
.form-group select.form-input {
  /* form-input 클래스 스타일을 상속받으므로 특별한 건 필요 없으나,
     브라우저 기본 화살표를 사용하도록 둡니다. */
  appearance: auto;
}

/* 10. [추가] 사이드바 검색창 */
.sidebar-search {
  padding: 10px 15px;
  border-bottom: 1px solid var(--color-border);
  position: relative;
  flex-shrink: 0; /* 높이 고정 */
}

.sidebar-search .search-icon {
  position: absolute;
  left: 25px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-text-light);
  font-size: 1.1rem;
}

.sidebar-search input {
  width: 100%;
  padding: 10px 15px 10px 35px; /* 왼쪽 아이콘 공간 확보 */
  border-radius: var(--border-radius);
  border: 1px solid var(--color-border);
  background-color: var(--color-bg-light); /* 연한 회색 배경 */
  font-size: 0.95rem;
  font-family: inherit;
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}
.sidebar-search input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-secondary);
  background-color: var(--color-bg-white);
}

/* [추가] 검색 결과 헤더 (노트 목록 위) */
.search-result-header {
  padding: 10px 15px 5px;
  font-size: 0.9rem;
  color: var(--color-text-light);
  font-weight: 600;
}

/* [수정] 노트 목록의 상단 border를 제거 (검색창이 대신함) */
.note-list {
  /* border-top: 1px solid var(--color-border); (이 줄 삭제) */
  padding-top: 5px; /* (padding-top: 15px 였다면 5px로 줄임) */
}

/* 11. [추가/수정] 상세 보기에서 CKEditor 콘텐츠 스타일 */
.detail-view .ck-content { /* CKEditor 콘텐츠 영역 클래스 */
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--color-text-dark);
  /* CKEditor 빌드에 포함된 스타일 외 추가 스타일링 */
  padding: 0; /* detail-view의 패딩을 사용 */
}
/* CKEditor 요소들에 대한 추가 스타일 (필요 시) */
.detail-view .ck-content h1,
.detail-view .ck-content h2,
.detail-view .ck-content h3 {
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}
.detail-view .ck-content p {
  margin-bottom: 1em;
}
.detail-view .ck-content ul,
.detail-view .ck-content ol {
  padding-left: 2.5em; /* CKEditor 기본값 조정 */
  margin-bottom: 1em;
}
.detail-view .ck-content li {
  margin-bottom: 0.5em;
}
.detail-view .ck-content img {
  max-width: 100%;
  height: auto;
  border-radius: var(--border-radius);
  margin: 1em 0;
}
/* CKEditor 테이블 스타일은 기본적으로 괜찮음 */

/* 12. [추가] 폼 내부 CKEditor 높이/테두리 (선택사항) */
.form-view .ck.ck-editor__editable_inline {
  min-height: 300px; /* 에디터 최소 높이 */
  border: 1px solid var(--color-border);
  border-top: none; /* 툴바 아래 테두리 중복 제거 */
  border-bottom-left-radius: var(--border-radius);
  border-bottom-right-radius: var(--border-radius);
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}
.form-view .ck.ck-editor__editable_inline:focus {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-secondary);
}
.form-view .ck.ck-toolbar {
  border-top-left-radius: var(--border-radius);
  border-top-right-radius: var(--border-radius);
  border-color: var(--color-border);
}

/* 13. [Add] Form Header Layout */
.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px; /* Match h2 margin */
}
.form-header h2 {
  margin: 0; /* Remove default margin */
}

/* 14. [Add] Template Selector Dropdown (in Form Header) */
.template-selector {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--color-text-light);
}
.template-selector select {
  padding: 6px 10px;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  font-family: inherit;
  background-color: var(--color-bg-white);
  cursor: pointer;
}
.template-selector select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-secondary);
}

/* 15. [Add] "Save as Template" Button (in Form Buttons) */
.form-template-btn {
  /* Use similar styles to cancel button, but maybe different color */
  background-color: #e9ecef; /* Lighter gray */
  color: #495057; /* Darker text */
  border: none;
  border-radius: var(--border-radius);
  padding: 12px 15px; /* Slightly less padding than main buttons */
  font-size: 0.95rem; /* Slightly smaller text */
  font-weight: 600;
  cursor: pointer;
  display: flex; /* Align icon and text */
  align-items: center;
  gap: 6px;
  transition: background-color var(--transition-fast), transform var(--transition-fast);
}
.form-template-btn:hover {
  background-color: #dee2e6;
  transform: translateY(-1px);
}

/* 16. [Add] Template List Section (Sidebar) */
.template-list-section {
  padding: 10px 10px 15px 10px;
  border-bottom: 1px solid var(--color-border);
  flex-shrink: 0;
  max-height: 25vh; /* Limit height, adjust as needed */
  overflow-y: auto;
}
.template-list-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-light);
  padding: 5px;
  margin-bottom: 5px;
}
.template-list-header h4 {
  margin: 0;
}

/* Individual Template Item */
.template-item {
  display: flex;
  justify-content: space-between; /* Align name and button */
  align-items: center;
  padding: 8px 12px; /* Smaller padding */
  border-radius: var(--border-radius);
  font-size: 0.9rem; /* Smaller font */
  color: var(--color-text-dark);
  transition: background-color var(--transition-fast);
}
.template-item span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-right: 10px; /* Space before delete button */
}
.template-item:hover {
  background-color: #f0f0f0;
}

/* Template Delete Button */
.template-delete-btn {
  background: none;
  border: none;
  color: var(--color-text-light);
  cursor: pointer;
  padding: 2px;
  border-radius: 50%;
  display: none; /* Hidden by default */
  font-size: 0.8rem; /* Smaller icon */
  transition: color var(--transition-fast), background-color var(--transition-fast);
}
.template-item:hover .template-delete-btn {
  display: block; /* Show on hover */
}
.template-delete-btn:hover {
  color: var(--color-danger);
  background-color: #fbebee;
}

/* Empty Template List Message */
.template-list-empty {
  text-align: center;
  color: #999;
  padding: 10px;
  font-size: 0.85rem;
  font-style: italic;
}

/* Adjust Note List border/padding if Template section is added above search */
.sidebar-search {
  border-top: 1px solid var(--color-border); /* Add top border to search */
}
.note-list {
  border-top: none; /* Remove top border from note list */
  padding-top: 5px;
}